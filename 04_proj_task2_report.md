# 2020-DBMS-project

**小组成员**

| 学号 | 姓名 |
| :-------:| :---:|
| 18308008 | 车春江|
| 18353070 | 谭嘉伟|
| 17364025 | 贺恩泽|
| 18324061 | 文君逸|

## 项目内容

&emsp;&emsp;实验项目完成的目标是完成基于针对NVM优化的可扩展哈希的数据结构，实现一个简单的键值存储引擎PmEHash。我们用data_page来实现数据页表的相关操作实现。    
&emsp;&emsp;此项目对外可用的对数据的基本操作就增删改查：

+ Insert增
+ Remove删
+ Update改
+ Find查
+ 删除所有数据
+ 恢复状态
  

&emsp;&emsp;在上述的每一次操作后都能立刻将数据持久化，不仅在程序关闭重新运行后能够重新恢复状态，而且可以防止程序运行过程中崩溃或掉电导致的数据崩溃。  
&emsp;&emsp;此项目需要完成的任务有：

+ 用内存模拟NVM
+ 实现代码框架的功能并进行简单的Google test，运行并通过ehash_test.cpp中的简单测试
+ 编写main函数进行YCSB benchmark测试，读取workload中的数据文件进行增删改查操作，测试运行时间并截图性能结果。

## 项目实现方法

## gtest结果

![gtest](./images/gtest.png)

## ycsb结果

![ycsb](./images/ycsb.png)

## ycsb结果分析

&emsp;&emsp;在上图中我们以500万次操作进行测试，其中在Run环节增删查改的比例是相同的。我们可以看到，插入的时间远远大于其他时间，删除操作所需的时间略长，最快的是查询和更新操作。对于以上情况的出现，我们分析一下四种操作执行了哪些步骤，时间复杂度是怎样的。

### Insert(插入数据)

&emsp;&emsp;在插入数据的时候，首先我们调用了**search**函数来查看一个键值是否存在，也就是说插入数据的过程包含了查找数据的过程。另外，当插入数据时还有几种特殊情况需要考虑   

+ 插入数据的哈希值对应的页号不存在时，需要分配新的一页，花费时间为 ___O(data_page_slot_num)___  
+ 当一个桶满的时候，将进行对桶的分裂，同时还有可能触发目录的倍增，这两个过程的时间复杂度分别为 ___O(bucket_slot_num + catalog_length)___ 和 ___O(catalog_length)___ 。值得注意的是**catalog_length**和全局深度**global_depth**是成指数关系的。

### Search(查找数据)

&emsp;&emsp;查询时可以直接由哈希值定位到桶的虚拟地址，因此只需要对整个桶所有的槽进行遍历即可，因此时间复杂度为 ___O(bucket_slot_num)___ 。

### Remove(删除数据)

&emsp;&emsp;删的过程需要先找到这个数据，也就是包含了查找的过程，但是由于删除数据之后，一个桶可能变为空桶，因此要回收这个桶的空间，回收桶的时间复杂度为 ___O(catalog_length)___ 。

### Update(更新数据)

&emsp;&emsp;更新数据的过程和查找数据的过程时间复杂度是一样的，只需要在找到数据之后进行一次修改操作就可以了。

### 总体分析

&emsp;&emsp;综上来看，插入操作所花费的时间是最长的，删除操作的时间次之，更新数据在查询数据的基础进行修改，所以比查询数据的所需时间略微多一点，这个结论与截图中的结果是一致的。